

<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Do. Reflect. Learn. Repeat!</title>
  <meta name="description" content="Excercises in public learning">
  <meta name="author" content="Peter Zsoldos">

  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://feeds.feedburner.com/zsoldosp" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link href="/css/reset.css" media="screen" rel="stylesheet" type="text/css" /> 
  <link href="/css/main.css" media="screen" rel="stylesheet" type="text/css" /> 

</head>

  <body>
    <div id="header">
      <div class="inner">
                <ul>
                    <li><a href="https://twitter.com/zsepi">@zsepi</a></li>
                    <li><a href="/about.html">about me</a></li>
                    <li><a href="/category/software/">software</a></li>
                    <li><a href="/category/outdoors/">outdoors</a></li>
                </ul>
                <h1><a href="/">Do. Reflect. Learn. Repeat!</a></h1>
                <h2>Excercises in public learning</h2>
      </div>
    </div>
    <div id="content">
        <div class="inner">
            




<div class="post">
    <h3><a href="/2013/07/25/some-metaprogramming-reflection-in-bash//">Some Metaprogramming (Reflection) In Bash</a></h3>
  
    <div class="body">
        <p>I needed to write a function in bash that would set an environment 
variable to that value, unless the variable has been already set. 
This is a typical metaprogramming (reflection, introspection, etc.) 
task. </p>
<p>However, searching for the terms I know (reflection, metaprogramming) 
did not yield any bash results, since the bash terminology is <em>variable
variable</em> or <em>dereferencing</em>. I hope the title of this post will help
other non-native bash script writers searching for the "wrong" keywords!</p>
<p>The trick is the <code>${!&lt;variable name&gt;}</code> construct - it will be interpreted
as <code>${&lt;variable name's value&gt;}</code>. An example</p>
<pre><code>$ a="aaaaa"
$ b="bbbbb"
$ echo $a
aaaaa
$ echo $b
bbbbb
$ variable_name="a"
$ echo ${!variable_name}
aaaaa
$ variable_name="b"
$ echo ${!variable_name}
bbbbb
</code></pre>
<p>Of course, I could only find it offline (thanks, <a href="https://www.xing.com/profiles/Dieter_Loskarn">Dieter</a>!). 
Armed with this kowledge, the function itself becomes easy -</p>
<pre><code>function env_or_default() {
    name=$1
    default=$2
    if [[ ${!name} == "" ]]; then
        echo "no value set for $name, setting it to default value $default"
        export $name=$default
    else
        echo "value for $name was passed in from the environment, it's value is ${!name}"
    fi
}
</code></pre>
<p>Obviously, the <code>echo</code> lines are there just for illustration.</p>
<pre><code>$ env_or_default NOT_SET not-set-default-value
no value set for NOT_SET, setting it to default value not-set-default-value
$ export ALREADY_SET=already-has-value
$ env_or_default ALREADY_SET already-set-default-value
value for ALREADY_SET was passed in from the environment, it's value is already- has-value
$ echo $NOT_SET
not-set-default-value
$ echo $ALREADY_SET
already-has-value
</code></pre>
<p>Happy scripting! </p>
<p>P.S.: Krzysztof Wilczynski showed another <a href="https://gist.github.com/kwilczynski/5877621">trick to do 
this</a>:</p>
<pre><code>random_file_name() {
    local __return=$1
    eval $__return="'$(date +"$(basename -- "$0")_%s_${RANDOM}_$$")'"
}

random_file_name FILE_NAME
echo $FILE_NAME
</code></pre>
    </div>
    <div class="meta">
        <p>What do you think? I would love if you would <strong>leave a comment</strong> - drop me an <strong>email</strong> at <strong><a href="mailto:hello@zsoldosp.eu">hello@zsoldosp.eu</a></strong>.
    </div>
    <div class="meta">
        <p>Posted on <a href="/2013/07/25/some-metaprogramming-reflection-in-bash//">July 25, 2013 at 08:18 AM</a> in <span class="blog_post_categories"><a href='/category/code/'>code</a>, <a href='/category/metaprogramming/'>metaprogramming</a>, <a href='/category/bash/'>bash</a>, <a href='/category/software/'>software</a></span></p>
    </div>
    


        </div>
    </div>
        <div id="footer" class="clearfix">
            <div class="inner">
                <div class="about">
                    <h3><a href="/about.html">About Me</a></h3>
                    
                    <a href="/about.html"><img src="/img/me_small.jpg" alt="ME" /></a>
                    <div>
                        I'm a software developer and outdoors enthusiast among other things. <a href="/about.html">Read more</a>
                    </div>
                </div>
            <div class="about">
                <p>Powered by <a href="http://www.blogofile.com">Blogofile</a></p>
                <p>Template from <a href="https://github.com/jamesyu/jamesyu_jekyll_template">James Yu's Jekyll template</a>

<p>This is a personal weblog. The opinions expressed here are my own and not necessarily reflect those of my - current or former - employers'.

<p>All posts - unless noted otherwise - are licensed under a Creative Commons Attribution-Noncommercial-Share Alike 3.0 License.

<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="license"><img alt="Creative Commons License" style="border-width: 0pt;" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a></p>
                
            </div>
        </div>
  <script>
      if(window.location.href.indexOf("http://blog.zsoldosp.eu") != -1) {
          var _gaq=[['_setAccount','UA-1962998-2'],['_trackPageview']];
          (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
          g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
          s.parentNode.insertBefore(g,s)}(document,'script'));
      }
  </script>
    </body> 
</html>

